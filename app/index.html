<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Ave IRC Client</title>
        <link href="res/css/style.css" rel="stylesheet" />
        <link rel="stylesheet" href="../node_modules/material-design-lite/material.min.css">
        <style>
        .demo-layout-transparent .mdl-layout__header,
        .demo-layout-transparent .mdl-layout__drawer-button {
        /* This background is dark, so we set text to white. Use 87% black instead if
         your background is light. */
        color: rgba(0, 0, 0, 0.87);
        }
        </style>
        <script src="../node_modules/material-design-lite/material.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script>
            function updateScroll(){
                var element = document.getElementById("clog");
                element.scrollTop = element.scrollHeight;
            }

            const electron = require("electron");

            // we have to import jQuery weirdly because of Electron
            window.$ = window.jQuery = require(__dirname + '/res/js/jquery.min.js');

            electron.ipcRenderer.on("pingchan", function(event, message){
                console.log(message);
                updateScroll();
            });

            electron.ipcRenderer.on("newmsg", function(event, channel, message, sender, time){
                console.log(message);
                var div = document.createElement("div");
                div.className = "message";
                if(channel == "sys" || sender == "[System]"){
                    div.className += " sysmsg";
                }
                var main = document.createElement("p");
                var text = document.createTextNode(message);
                main.appendChild(text);
                var meta = document.createElement("p");
                meta.className = "meta";
                var metaText = document.createTextNode(sender + ":");
                meta.appendChild(metaText);
                div.appendChild(meta);
                div.appendChild(main);
                // div.innerHTML = message;
                document.getElementById("clog").appendChild(div);
                updateScroll();
            });

            function sendMsg(recipient, type, message){
                electron.ipcRenderer.send("sendmsg", recipient, type, message);
            }

            $(document).ready(function(){
                $('#send').submit(function(){
                    console.log($('#msg').val());
                    if($("#msg").val() != ""){
                        sendMsg("sys", 'msg', $('#msg').val().toString());
                        $("#msg").val("");
                    }
                    return false;
                });
            });
        </script>
    </head>

    <body>
        <div class="demo-layout-transparent mdl-layout mdl-js-layout">
          <header class="mdl-layout__header mdl-layout__header--transparent">
            <div class="mdl-layout__header-row">
              <!-- Title -->
              <span class="mdl-layout-title">#channel</span>
            </div>
          </header>
          <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">#channel</span>
            <nav class="mdl-navigation">
              <a class="mdl-navigation__link" href="">Link</a>
              <a class="mdl-navigation__link" href="">Link</a>
              <a class="mdl-navigation__link" href="">Link</a>
              <a class="mdl-navigation__link" href="">Link</a>
            </nav>
          </div>
          <main class="mdl-layout__content">
              <div class="flex">
                  <div class="chatLog" id="clog">
                      <div class="message">
                          <p>hey, scratso!</p>
                          <p class="meta">
                              Person, 18:45 26/09/2016
                              <span class="msgId">#1</span>
                          </p>
                      </div>
                      <div class="message">
                          <p>hey, person!</p>
                          <p class="meta">
                              Scratso, 18:46 26/09/2016
                              <span class="msgId">#2</span>
                          </p>
                      </div>
                  </div>
                  <div class="usrList">
                      <p>Online Users and <span class="op">Operators</span></p>
                      <ul>
                          <li class="op">Person</li>
                          <li class="op">Another</li>
                          <li>Scratso</li>
                          <li>Standard</li>
                          <li>User</li>
                          <li>IRCUser</li>
                          <li>Identify</li>
                      </ul>
                  </div>
              </div>
              <div class="msg">
                  <form id="send">
                      <input type="text"size="100%" name="msg" id="msg" placeholder="Enter message here." />
                      <button type="submit">
                          <svg id="send-icon" class="send-icon" viewBox="0 0 24 24">
                              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                          </svg>
                      </button>
                  </form>
              </main>
            </div>
        </div>
    </body>
</html>
